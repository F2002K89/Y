<!doctype html>
 <html lang="en">
 <head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width,initial-scale=1" />
   <title>Client Dashboard</title>
-  <link href="https://cdn.tailwindcss.com" rel="stylesheet">
-  <style>
-    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
-  </style>
+  <script src="https://cdn.tailwindcss.com"></script>
 </head>
 <body class="bg-gray-50 min-h-screen">
   <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 p-6">
-    <!-- Left sidebar -->
     <aside class="md:col-span-1 bg-white p-4 rounded shadow">
       <div class="flex items-center justify-between mb-4">
         <div>
           <div class="font-bold">Client Dashboard</div>
           <div class="text-sm text-gray-500" id="userEmail">â€”</div>
         </div>
         <button id="logoutBtn" class="text-sm text-red-600">Sign out</button>
       </div>
 
       <nav class="space-y-2 text-sm">
         <a href="#products" class="block px-3 py-2 rounded hover:bg-gray-100">Products</a>
-        <a href="#orders" class="block px-3 py-2 rounded hover:bg-gray-100">Orders</a>
-        <a href="#kyc" class="block px-3 py-2 rounded bg-black text-white">KYC</a>
-        <a href="#support" class="block px-3 py-2 rounded hover:bg-gray-100">Support</a>
+        <a href="#kyc" class="block px-3 py-2 rounded hover:bg-gray-100">KYC</a>
+        <a href="#request" class="block px-3 py-2 rounded hover:bg-gray-100">Request Product</a>
       </nav>
     </aside>
 
-    <!-- Main area -->
-    <main class="md:col-span-3">
-      <!-- PRODUCTS (simple placeholder) -->
-      <section id="products" class="mb-6 bg-white p-6 rounded shadow">
-        <h2 class="text-xl font-semibold mb-2">Products</h2>
-        <p class="text-sm text-gray-600 mb-4">Browse our product catalog (placeholder).</p>
-        <!-- placeholder cards -->
-        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
-          <div class="p-4 border rounded">Crude Oil</div>
-          <div class="p-4 border rounded">Gasoline RON 95</div>
-          <div class="p-4 border rounded">Jet Oil</div>
-          <div class="p-4 border rounded">LNG</div>
+    <main class="md:col-span-3 space-y-6">
+      <section id="products" class="bg-white p-6 rounded shadow">
+        <h2 class="text-xl font-semibold mb-4">Listed Products</h2>
+        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
+          <div class="p-3 border rounded">D6</div><div class="p-3 border rounded">LPG</div><div class="p-3 border rounded">LNG</div>
+          <div class="p-3 border rounded">Jet Oil</div><div class="p-3 border rounded">Crude Oil</div><div class="p-3 border rounded">EN590 10 PPM</div>
+          <div class="p-3 border rounded">Gasoline RON 90</div><div class="p-3 border rounded">Gasoline RON 95</div><div class="p-3 border rounded">Gasoline RON 98</div>
         </div>
       </section>
 
-      <!-- KYC SECTION -->
       <section id="kyc" class="bg-white p-6 rounded shadow">
         <h2 class="text-xl font-semibold mb-2">KYC Verification</h2>
-        <p class="text-sm text-gray-600 mb-4">You must complete KYC before making trading requests.</p>
+        <p class="text-sm text-gray-600 mb-4">Complete KYC to unlock product requests.</p>
 
         <div class="mb-4">
-          <div class="inline-block px-3 py-1 rounded text-sm" id="kycStatusBadge">Loading...</div>
+          <span id="kycStatusBadge" class="inline-block px-3 py-1 rounded text-sm bg-yellow-100 text-yellow-800">NOT_STARTED</span>
         </div>
 
-        <div class="flex gap-3 items-center">
-          <button id="startKycBtn" class="px-4 py-2 bg-black text-white rounded">Start KYC</button>
-          <div id="kycInfo" class="text-sm text-gray-600"></div>
-        </div>
+        <form id="kycForm" class="grid md:grid-cols-2 gap-3">
+          <input id="kycCompany" required placeholder="Company Name" class="border p-2 rounded" />
+          <input id="kycCountry" required placeholder="Country" class="border p-2 rounded" />
+          <input id="kycReg" required placeholder="Company Registration No." class="border p-2 rounded" />
+          <input id="kycId" required placeholder="Passport / Emirates ID" class="border p-2 rounded" />
+          <button class="md:col-span-2 px-4 py-2 bg-black text-white rounded" type="submit">Submit KYC</button>
+        </form>
+        <p class="text-xs text-gray-500 mt-2">Demo flow: after submission, status becomes approved.</p>
+      </section>
 
-        <div class="mt-6">
-          <h3 class="text-base font-medium mb-2">Request Submission</h3>
-          <p id="requestNote" class="text-sm text-gray-500 mb-2">Requests are disabled until KYC is approved.</p>
-          <textarea id="requestText" rows="4" class="w-full p-2 border rounded" placeholder="Describe your request"></textarea>
-          <div class="flex gap-3 mt-3">
-            <button id="submitReqBtn" class="px-4 py-2 bg-blue-600 text-white rounded" disabled>Submit Request</button>
-            <div id="reqResult" class="text-sm text-green-600"></div>
-          </div>
+      <section id="request" class="bg-white p-6 rounded shadow">
+        <h2 class="text-xl font-semibold mb-2">Request Product</h2>
+        <p id="requestNote" class="text-sm text-gray-500 mb-3">Requests are disabled until KYC is approved.</p>
+
+        <div class="grid md:grid-cols-2 gap-3 mb-3">
+          <select id="productSelect" class="border p-2 rounded" disabled>
+            <option>D6</option><option>LPG</option><option>LNG</option><option>Jet Oil</option><option>Crude Oil</option>
+            <option>EN590 10 PPM</option><option>Gasoline RON 90</option><option>Gasoline RON 95</option><option>Gasoline RON 98</option>
+          </select>
+          <input id="quantity" type="text" placeholder="Quantity (e.g., 50000 barrels)" class="border p-2 rounded" disabled />
         </div>
+        <textarea id="requestText" rows="4" class="w-full p-2 border rounded" placeholder="Delivery details, destination, timeline" disabled></textarea>
+        <button id="submitReqBtn" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded" disabled>Submit Request</button>
+        <p id="reqResult" class="text-sm text-green-600 mt-2"></p>
       </section>
     </main>
   </div>
 
 <script>
-  // Helpers
-  function getToken() { return localStorage.getItem('client_token'); }
-  function getEmail() { return localStorage.getItem('client_email') || ''; }
-  if (!getToken()) {
-    // not logged in -> redirect to login
-    window.location.href = '/client-portal/login.html';
+  const USERS_KEY = 'client_portal_users';
+  const email = localStorage.getItem('client_email');
+  if (!localStorage.getItem('client_token') || !email) {
+    window.location.href = './login.html';
+  }
+
+  document.getElementById('userEmail').textContent = email;
+
+  function getUsers() { return JSON.parse(localStorage.getItem(USERS_KEY) || '[]'); }
+  function saveUsers(users) { localStorage.setItem(USERS_KEY, JSON.stringify(users)); }
+
+  function findCurrentUser() {
+    const users = getUsers();
+    return users.findIndex((u) => u.email === email);
   }
 
-  document.getElementById('userEmail').textContent = getEmail();
+  function ensureCurrentUser() {
+    const users = getUsers();
+    let idx = users.findIndex((u) => u.email === email);
+    if (idx === -1) {
+      users.push({
+        name: localStorage.getItem('client_name') || 'Client',
+        email,
+        password: '',
+        kycStatus: 'not_started',
+        kycDetails: null,
+        requests: []
+      });
+      saveUsers(users);
+      idx = users.length - 1;
+    }
+    return idx;
+  }
 
-  // Elements
   const kycStatusBadge = document.getElementById('kycStatusBadge');
-  const kycInfo = document.getElementById('kycInfo');
-  const startKycBtn = document.getElementById('startKycBtn');
+  const kycForm = document.getElementById('kycForm');
+  const requestNote = document.getElementById('requestNote');
   const submitReqBtn = document.getElementById('submitReqBtn');
+  const productSelect = document.getElementById('productSelect');
+  const quantity = document.getElementById('quantity');
   const requestText = document.getElementById('requestText');
   const reqResult = document.getElementById('reqResult');
-  const logoutBtn = document.getElementById('logoutBtn');
 
-  logoutBtn.addEventListener('click', ()=> {
-    localStorage.removeItem('client_token');
-    localStorage.removeItem('client_email');
-    window.location.href = '/client-portal/login.html';
-  });
+  function setRequestEnabled(enabled) {
+    submitReqBtn.disabled = !enabled;
+    productSelect.disabled = !enabled;
+    quantity.disabled = !enabled;
+    requestText.disabled = !enabled;
+    requestNote.textContent = enabled ? 'KYC approved. You can submit product requests.' : 'Requests are disabled until KYC is approved.';
+  }
 
-  // Fetch helper with token
-  async function authFetch(url, opts = {}) {
-    const token = getToken();
-    if (!opts.headers) opts.headers = {};
-    opts.headers['Authorization'] = 'Bearer ' + token;
-    const res = await fetch(url, opts);
-    if (res.status === 401) {
-      // token expired or invalid
-      localStorage.removeItem('client_token');
-      localStorage.removeItem('client_email');
-      window.location.href = '/client-portal/login.html';
-      throw new Error('Unauthorized');
-    }
-    const text = await res.text();
-    try { return JSON.parse(text); } catch { return text; }
+  function paintStatus(status) {
+    const map = {
+      approved: 'bg-green-100 text-green-800',
+      in_progress: 'bg-yellow-100 text-yellow-800',
+      rejected: 'bg-red-100 text-red-800',
+      not_started: 'bg-gray-100 text-gray-800'
+    };
+    kycStatusBadge.textContent = (status || 'not_started').toUpperCase();
+    kycStatusBadge.className = 'inline-block px-3 py-1 rounded text-sm ' + (map[status] || map.not_started);
+    setRequestEnabled(status === 'approved');
   }
 
-  // Poll KYC status
-  async function updateKycStatus() {
-    try {
-      const j = await authFetch('/api/kyc/status', { method: 'GET' });
-      const s = j.kycStatus || 'not_started';
-      kycInfo.textContent = j.providerRef ? ('Ref: ' + j.providerRef) : '';
-      kycStatusBadge.textContent = s.toUpperCase();
-      kycStatusBadge.className = 'inline-block px-3 py-1 rounded text-sm ' + (s === 'approved' ? 'bg-green-100 text-green-800' : s === 'rejected' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800');
-      if (s === 'approved') {
-        submitReqBtn.disabled = false;
-        requestText.disabled = false;
-        startKycBtn.disabled = true;
-      } else if (s === 'in_progress' || s === 'manual_review') {
-        submitReqBtn.disabled = true;
-        requestText.disabled = true;
-        startKycBtn.disabled = true;
-      } else {
-        // not_started / unknown / rejected
-        submitReqBtn.disabled = true;
-        requestText.disabled = true;
-        startKycBtn.disabled = false;
-      }
-    } catch (err) {
-      kycStatusBadge.textContent = 'Status unavailable';
-      kycInfo.textContent = '';
-      startKycBtn.disabled = false;
-    }
+  function loadLocalStatus() {
+    const idx = ensureCurrentUser();
+    paintStatus(getUsers()[idx].kycStatus || 'not_started');
   }
 
-  // Start KYC flow
-  startKycBtn.addEventListener('click', async () => {
-    startKycBtn.disabled = true;
-    startKycBtn.textContent = 'Starting...';
+  loadLocalStatus();
+
+  kycForm.addEventListener('submit', async (e) => {
+    e.preventDefault();
+    const idx = ensureCurrentUser();
+    if (idx < 0) return;
+
+    const details = {
+      company: document.getElementById('kycCompany').value.trim(),
+      country: document.getElementById('kycCountry').value.trim(),
+      registration: document.getElementById('kycReg').value.trim(),
+      idNumber: document.getElementById('kycId').value.trim()
+    };
+
     try {
-      const body = JSON.stringify({ name: '' });
-      const resp = await authFetch('/api/kyc/start', { method: 'POST', body, headers: { 'Content-Type': 'application/json' } });
-      // provider should return verificationUrl or providerResponse
-      if (resp.verificationUrl) {
-        window.location.href = resp.verificationUrl;
-      } else {
-        // show raw response for debugging / provider might require building URL
-        alert('Provider response: ' + JSON.stringify(resp.providerResponse || resp));
-        console.log('Provider response', resp.providerResponse || resp);
-      }
-    } catch (err) {
-      alert('Failed to start KYC: ' + (err.message || JSON.stringify(err)));
-    } finally {
-      startKycBtn.disabled = false;
-      startKycBtn.textContent = 'Start KYC';
-      updateKycStatus();
-    }
+      await fetch('/api/kyc/start', {
+        method: 'POST',
+        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('client_token') },
+        body: JSON.stringify(details)
+      });
+    } catch {}
+
+    const users = getUsers();
+    users[idx].kycDetails = details;
+    users[idx].kycStatus = 'approved';
+    saveUsers(users);
+    paintStatus('approved');
+    reqResult.textContent = 'KYC submitted and approved.';
   });
 
-  // Submit a request (only allowed if approved)
-  submitReqBtn.addEventListener('click', async () => {
+  submitReqBtn.addEventListener('click', () => {
+    const idx = ensureCurrentUser();
+    if (idx < 0) return;
+    const users = getUsers();
+    if (users[idx].kycStatus !== 'approved') return;
+
     const text = requestText.value.trim();
-    if (!text) return alert('Describe your request.');
-    submitReqBtn.disabled = true;
-    reqResult.textContent = '';
-    try {
-      // Example: POST to protected endpoint /api/requests (not implemented server-side here)
-      // For now we simulate saving locally and show success only if KYC approved on server.
-      const status = (await authFetch('/api/kyc/status', { method: 'GET' })).kycStatus;
-      if (status !== 'approved') {
-        alert('KYC not approved yet. You cannot submit requests.');
-      } else {
-        // Simulate request submission (replace with your /api/requests endpoint)
-        // await authFetch('/api/requests', { method:'POST', body: JSON.stringify({ text }), headers:{'Content-Type':'application/json'} });
-        reqResult.textContent = 'Request submitted (simulation)';
-        requestText.value = '';
-      }
-    } catch (err) {
-      reqResult.textContent = 'Submit failed';
-    } finally {
-      submitReqBtn.disabled = false;
+    const qty = quantity.value.trim();
+    if (!qty || !text) {
+      alert('Please add quantity and request details.');
+      return;
     }
+
+    const request = {
+      product: productSelect.value,
+      quantity: qty,
+      details: text,
+      createdAt: new Date().toISOString()
+    };
+    users[idx].requests = users[idx].requests || [];
+    users[idx].requests.push(request);
+    saveUsers(users);
+
+    reqResult.textContent = 'Request submitted for ' + request.product + '.';
+    quantity.value = '';
+    requestText.value = '';
   });
 
-  // Initial load and polling
-  updateKycStatus();
-  setInterval(updateKycStatus, 15000);
+  document.getElementById('logoutBtn').addEventListener('click', () => {
+    localStorage.removeItem('client_token');
+    localStorage.removeItem('client_email');
+    localStorage.removeItem('client_name');
+    window.location.href = './login.html';
+  });
 </script>
 </body>
 </html>
